name: Infrastructure CI/CD

on:
  push:
    branches: [master, main, develop]
  pull_request:
    branches: [master, main, develop]

jobs:
  validate:
    name: Validate Docker Compose Configuration
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Validate docker-compose.yaml syntax
        run: docker compose config --quiet

      - name: Display docker-compose configuration
        run: docker compose config

      - name: Check for deprecated syntax
        run: docker compose config 2>&1 | grep -i "warning" && echo "Warnings found" || echo "No warnings"
        continue-on-error: true

  lint:
    name: Lint and Verify Files
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Check README exists
        run: test -f README.md && echo "README.md found" || echo "README.md missing"

      - name: Check DEPLOYMENT guide exists
        run: test -f DEPLOYMENT.md && echo "DEPLOYMENT.md found" || echo "DEPLOYMENT.md missing"

      - name: Verify docker-compose.yaml exists
        run: test -f docker-compose.yaml && echo "docker-compose.yaml found" || exit 1

      - name: Check for .env.example
        run: |
          if [ -f .env.example ]; then
            echo ".env.example found"
          else
            echo ".env.example not found (optional)"
          fi
        continue-on-error: true
